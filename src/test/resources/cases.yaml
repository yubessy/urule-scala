- caption: simplest rule

  rule:
    host: '^example\.com$'
    category: example

  cases:
    - url: http://example.com/
      expected:
        category: example

    - url: http://other.com/
      expected: ~


- caption: seq of rules

  rule:
    - host: '^foo\.example\.com$'
      category: foo
    - host: '^bar\.example\.com$'
      category: bar

  cases:
    - url: http://foo.example.com/
      expected:
        category: foo

    - url: http://bar.example.com/
      expected:
        category: bar

    - url: http://baz.example.com/
      expected: ~


- caption: rule with children

  rule:
    host: '^(?:\w+\.)?example\.com$'
    category: example
    rules:
      - host: '^foo\.example\.com$'
        category: foo
      - host: '^bar\.example\.com$'
        category: bar

  cases:
    - url: http://example.com/
      expected:
        category: example

    - url: http://foo.example.com/
      expected:
        category: foo

    - url: http://bar.example.com/
      expected:
        category: bar

    - url: http://baz.example.com/
      expected:
        category: example


- caption: host matcher

  rule:
    host: '^example\.com$'
    category: matched

  cases:
    - url: http://example.com/
      expected:
        category: matched

    - url: http://other.com/
      expected: ~


- caption: path matcher

  rule:
    path: '^/foo$'
    category: foo

  cases:
    - url: http://example.com/foo
      expected:
        category: foo

    - url: http://example.com/bar
      expected: ~


- caption: params matcher

  rule:
    params:
      foo: '^aaa$'
      bar: '^bbb$'
    category: matched

  cases:
    - url: http://example.com/?foo=aaa&bar=bbb
      expected:
        category: matched

    - url: http://example.com/?foo=aaa
      expected: ~

    - url: http://example.com/?foo=aaa&bar=ccc
      expected: ~


- caption: compound matcher

  rule:
    host: '^example\.com$'
    path: '^/foo$'
    params:
      bar: '^baz$'
    category: matched

  cases:
    - url: http://example.com/foo?bar=baz
      expected:
        category: matched

    - url: http://other.com/foo?bar=baz
      expected: ~

    - url: http://example.com/other?bar=baz
      expected: ~

    - url: http://example.com/foo?bar=other
      expected: ~


- caption: category

  rule:
    host: 'example'
    category: example
    rules:
      - host: '^foo\.example\.com$'
        category: foo_example

  cases:
    - url: http://example.com/
      expected:
        category: example

    - url: http://foo.example.com/
      expected:
        category: foo_example


- caption: attrs

  rule:
    host: 'example'
    attrs:
      dom: example
      sub: nothing
    rules:
      - host: '^foo\.example\.com$'
        attrs:
          sub: foo
          tld: com

  cases:
    - url: http://example.com/
      expected:
        attrs:
          dom: example
          sub: nothing

    - url: http://foo.example.com/
      expected:
        attrs:
          dom: example
          sub: foo
          tld: com
